<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE ç™»å…¥ - æ­¡æ¨‚å¤§å¯Œç¿</title>
    <style>
        /* ä¿æŒæ‚¨çš„ CSS æ¨£å¼ */
    </style>
</head>
<body>
    <div class="login-box">
        <div class="logo">ğŸ²</div>
        <h1>æ­¡æ¨‚å¤§å¯Œç¿</h1>
        <p>æ­¡è¿ä¾†åˆ°æ¿æ©‹å•†åœˆï¼<br>è«‹å…ˆä½¿ç”¨ LINE ç™»å…¥é–‹å§‹éŠæˆ²</p>
        <button class="line-login-btn" onclick="startLineLogin()">
            <span>ğŸ“±</span>
            <span>ä½¿ç”¨ LINE ç™»å…¥</span>
        </button>
    </div>

    <script>
        const LINE_CHANNEL_ID = '2008231249';
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbydMhPLcjmxe7TJzZ-Ck6XNu3atpXygBFIyN7A7o6-14xKpzy6i3kuYap6Yy8liRKQm/exec';
        
        function startLineLogin() {
            // ç›´æ¥æ§‹å»º LINE ç™»å…¥ URL
            const state = 'state_' + Date.now();
            const loginUrl = `https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=${LINE_CHANNEL_ID}&redirect_uri=${encodeURIComponent('https://fangwl591021.github.io/richman/')}&state=${state}&scope=profile%20openid`;
            
            // è·³è½‰åˆ° LINE ç™»å…¥
            window.location.href = loginUrl;
        }

        // æª¢æŸ¥ URL åƒæ•¸ï¼Œè™•ç† LINE å›èª¿
        function checkLineCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            
            if (code && state) {
                // ä½¿ç”¨ LINE å‰ç«¯ SDK æˆ–ç›´æ¥è™•ç†
                handleLineCallback(code);
            }
        }

        // ç°¡å–®çš„ LINE ç™»å…¥è™•ç†ï¼ˆéœ€è¦ LINE Front-end Frameworkï¼‰
        function handleLineCallback(code) {
            // é€™è£¡å¯ä»¥ä½¿ç”¨ LINE Front-end Framework
            // æˆ–è€…ä½¿ç”¨ liff.init() å’Œ liff.getProfile()
            alert('LINE ç™»å…¥æˆåŠŸï¼ä»£ç¢¼: ' + code);
            // æ¨¡æ“¬ç™»å…¥æˆåŠŸ
            localStorage.setItem('lineUserId', 'user_' + Date.now());
            localStorage.setItem('lineDisplayName', 'æ¸¬è©¦ç”¨æˆ¶');
            window.location.href = 'game.html';
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥
        window.addEventListener('DOMContentLoaded', function() {
            // å¦‚æœå·²ç¶“ç™»å…¥ï¼Œè·³è½‰åˆ°éŠæˆ²
            if (localStorage.getItem('lineUserId')) {
                window.location.href = 'game.html';
            }
            // æª¢æŸ¥ LINE å›èª¿
            checkLineCallback();
        });
    </script>
</body>
</html>
