<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
<title>æ­¡æ¨‚å¤§å¯Œç¿</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>  
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Microsoft JhengHei",sans-serif;
  background:#111;
  height:100vh;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  padding-bottom:70px;
}

/* === LINE ç™»å…¥æ­¡è¿é é¢ === */
.login-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:999;padding:20px;
}
.login-screen.hidden{display:none;}
.login-box{
  background:white;border-radius:30px;
  padding:50px 40px;text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
  max-width:450px;width:100%;
  animation:slideIn 0.5s ease;
}
@keyframes slideIn{
  from{opacity:0;transform:translateY(-30px);}
  to{opacity:1;transform:translateY(0);}
}
.login-box .logo{
  font-size:80px;margin-bottom:20px;
  animation:bounce 1s infinite ease-in-out;
}
@keyframes bounce{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-10px);}
}
.login-box h1{
  font-size:36px;color:#333;margin-bottom:15px;
}
.login-box p{
  font-size:18px;color:#666;margin-bottom:40px;
  line-height:1.6;
}
.login-box .line-login-btn{
  width:100%;padding:20px;
  background:#06C755;color:white;
  border:none;border-radius:15px;
  font-size:24px;font-weight:bold;
  cursor:pointer;transition:all 0.3s ease;
  display:flex;align-items:center;justify-content:center;
  gap:15px;box-shadow:0 8px 20px rgba(6,199,85,0.3);
}
.login-box .line-login-btn:hover{
  background:#05b04b;transform:translateY(-2px);
  box-shadow:0 12px 30px rgba(6,199,85,0.4);
}
.login-box .line-login-btn .icon{
  font-size:32px;
}

.board{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translateY(-35px);
  width:95%;aspect-ratio:2/3;
  background:url("https://aiwe.cc/wp-content/uploads/2025/11/c4ca4238a0b923820dcc509a6f75849b-2.png") center/contain no-repeat;
  background-color:#000;border-radius:10px;overflow:hidden;
}
.player{
  position:absolute;
  width: 80px;    /* å¾ 150px æ”¹å° */
  height: 85px;   /* å¾ 160px æ”¹å° */
  transition:all .4s ease-in-out;
  z-index:10;
}
.player img{width:100%;height:100%;object-fit:contain;}
@keyframes walk{0%,100%{transform:rotate(0);}25%{transform:rotate(-4deg);}75%{transform:rotate(4deg);}}
.walking{animation:walk .45s infinite ease-in-out;}
.center{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  display:flex;flex-direction:column;align-items:center;gap:25px;
  z-index:5;
}
.msg{
  color:#000;
  font-size: 20px;  /* å¾ 28px æ”¹å° */
  font-weight:bold;
  text-shadow:1px 1px 2px rgba(255,255,255,.6);
  margin-bottom:5px;
  min-height:24px;
  transition:opacity .5s ease;
}
.dice-box{display:flex;gap:40px;}
.dice{
  width: 80px;    /* å¾ 160px æ”¹å° */
  height: 80px;   /* å¾ 160px æ”¹å° */
  background:white;
  border-radius:20px;  /* å¾ 30px æ”¹å° */
  box-shadow:0 5px 15px rgba(0,0,0,.3);  /* é™°å½±ä¹Ÿæ”¹å° */
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
}

.dot{
  width: 12px;    /* å¾ 22px æ”¹å° */
  height: 12px;   /* å¾ 22px æ”¹å° */
  background:black;
  border-radius:50%;
  position:absolute;
}

.dice-box{
  display:flex;
  gap: 20px;      /* å¾ 40px æ”¹å° */
}
.dot{width:22px;height:22px;background:black;border-radius:50%;position:absolute;}
.face-1 .dot:nth-child(1){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-2 .dot:nth-child(1){top:25%;left:25%;}
.face-2 .dot:nth-child(2){bottom:25%;right:25%;}
.face-3 .dot:nth-child(1){top:25%;left:25%;}
.face-3 .dot:nth-child(2){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-3 .dot:nth-child(3){bottom:25%;right:25%;}
.face-4 .dot:nth-child(1){top:25%;left:25%;}
.face-4 .dot:nth-child(2){top:25%;right:25%;}
.face-4 .dot:nth-child(3){bottom:25%;left:25%;}
.face-4 .dot:nth-child(4){bottom:25%;right:25%;}
.face-5 .dot:nth-child(1){top:25%;left:25%;}
.face-5 .dot:nth-child(2){top:25%;right:25%;}
.face-5 .dot:nth-child(3){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-5 .dot:nth-child(4){bottom:25%;left:25%;}
.face-5 .dot:nth-child(5){bottom:25%;right:25%;}
.face-6 .dot:nth-child(1){top:25%;left:25%;}
.face-6 .dot:nth-child(2){top:25%;right:25%;}
.face-6 .dot:nth-child(3){top:50%;left:25%;transform:translateY(-50%);}
.face-6 .dot:nth-child(4){top:50%;right:25%;transform:translateY(-50%);}
.face-6 .dot:nth-child(5){bottom:25%;left:25%;}
.face-6 .dot:nth-child(6){bottom:25%;right:25%;}
.roll-btn{
  padding: 15px 30px;    /* å¾ 25px 60px æ”¹å° */
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:white;
  font-size: 20px;       /* å¾ 34px æ”¹å° */
  font-weight:bold;
  border:none;
  border-radius: 25px;   /* å¾ 40px æ”¹å° */
  box-shadow:0 4px 10px rgba(0,0,0,.3);  /* å¾ 8px 20px æ”¹å° */
  cursor:pointer;
}

/* === ä¸Šåœ–ä¸‹æ–‡ åç‰‡ç‰ˆå½ˆçª— === */
.shop-popup{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:85%;max-width:520px;
  background:white;color:#222;
  border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,.4);
  overflow-y:auto;text-align:center;
  max-height:90vh;
  z-index:50;display:none;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-45%);}to{opacity:1;transform:translate(-50%,-50%);}}
.shop-popup img{
  width:100%;height:auto;object-fit:cover;
  display:block;
  background:#eee;
}
.shop-content{
  padding:15px 20px 25px;
}
.shop-content h2{
  font-size:32px;color:#222;margin-bottom:8px;
}
.shop-content p{
  font-size:22px;color:#555;margin-bottom:20px;
}
.shop-buttons{
  display:flex;flex-direction:column;align-items:center;gap:12px;
}
.shop-buttons button{
  width:95%;
  border:none;border-radius:12px;
  padding:16px 20px;font-size:36px;font-weight:bold;cursor:pointer;
  color:white;transition:transform .2s ease;
}
.shop-buttons button:active{transform:scale(0.95);}
.shop-buttons .claim{background:#764ba2;}
.shop-buttons .close{background:#888;}

/* === åº•éƒ¨åŠŸèƒ½å€ï¼ˆåœ–ç¤ºæ”¾å¤§2å€ï¼‰=== */
.bottom-bar{
  position:fixed;bottom:0;left:0;right:0;
  height:70px;background:rgba(0,0,0,0.85);
  display:flex;justify-content:space-around;align-items:center;
  z-index:100;backdrop-filter:blur(10px);
  border-top:2px solid rgba(255,255,255,0.1);
}
.bottom-bar button{
  flex:1;height:100%;border:none;
  background:transparent;color:white;
  font-size:14px;font-weight:bold;
  cursor:pointer;transition:all .3s ease;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;
}
.bottom-bar button:active{background:rgba(255,255,255,0.1);}
.bottom-bar button .icon{font-size:56px;} /* å¾28pxæ”¾å¤§åˆ°56px (2å€) */
.bottom-bar button.logged-in{color:#4caf50;}

/* === å„ªæƒ åˆ¸æ”¶é›†å€å½ˆçª— - é€²ä¸€æ­¥ç¸®å°ä¸‰åˆ†ä¹‹ä¸€ === */
.coupon-panel{
  position:fixed;top:0;left:0;right:0;bottom:70px;
  background:white;z-index:200;display:none;
  overflow-y:auto;padding:7px;
}

.coupon-panel-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:7px;
  padding-bottom:5px;
  border-bottom:2px solid #eee;
}

.coupon-panel-header h2{
  font-size:14px;
  color:#333;
}

.coupon-list{
  display:grid;
  gap:5px;
}

.coupon-card{
  border:1px solid #ddd;
  border-radius:5px;
  padding:5px;
  display:flex;
  gap:5px;
  background:white;
  box-shadow:0 1px 2px rgba(0,0,0,0.1);
}

.coupon-card img{
  width:35px;
  height:35px;
  object-fit:cover;
  border-radius:3px;
  flex-shrink:0;
}

.coupon-card-info{
  flex:1;
}

.coupon-card-info h3{
  font-size:11px;
  margin-bottom:2px;
  color:#333;
}

.coupon-card-info p{
  font-size:10px;
  color:#666;
  line-height: 1.4;
  white-space: pre-line;
  word-break: break-word;
}

.coupon-card-info .discount{
  color:#e53935;
  font-weight:bold;
}

.empty-state{
  text-align:center;
  padding:20px 7px;
  color:#999;
}

.empty-state .icon{
  font-size:24px;
  margin-bottom:7px;
}

.empty-state p{
  font-size:10px;
}

/* === åº—å®¶åœ°åœ–å½ˆçª— === */
.map-panel{
  position:fixed;top:0;left:0;right:0;bottom:70px;
  background:white;z-index:200;display:none;
  overflow-y:auto;
}
.map-panel.show{display:block;}
.map-panel-header{
  padding:15px 20px;background:#764ba2;color:white;
  display:flex;justify-content:space-between;align-items:center;
}
.map-panel-header h2{font-size:24px;}
.map-panel-header .close-btn{
  width:40px;height:40px;border:none;
  background:rgba(255,255,255,0.2);border-radius:50%;
  color:white;font-size:24px;cursor:pointer;
}
.map-container{
  padding:20px;
}
.shop-list{display:grid;gap:12px;}
.shop-item{
  border:1px solid #ddd;border-radius:10px;
  padding:12px;display:flex;gap:12px;
  background:white;
}
.shop-item img{
  width:60px;height:60px;object-fit:cover;
  border-radius:6px;flex-shrink:0;
}
.shop-item-info{flex:1;}
.shop-item-info h3{font-size:18px;margin-bottom:4px;}
.shop-item-info p{font-size:14px;color:#666;}
.shop-item-info .address{font-size:13px;color:#999;margin-top:4px;}

/* === è¼‰å…¥å‹•ç•« === */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- ğŸ” LINE ç™»å…¥æ­¡è¿é é¢ -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="logo">ğŸ²</div>
    <h1>æ­¡æ¨‚å¤§å¯Œç¿</h1>
    <p>æ­¡è¿ä¾†åˆ°æ¿æ©‹å•†åœˆï¼<br>è«‹å…ˆä½¿ç”¨ LINE ç™»å…¥é–‹å§‹éŠæˆ²ï¼Œ<br>æ”¶é›†å°ˆå±¬å„ªæƒ åˆ¸å§ï¼</p>
    <button class="line-login-btn" onclick="startLineLogin()">
      <span class="icon">ğŸ“±</span>
      <span>ä½¿ç”¨ LINE ç™»å…¥</span>
    </button>
  </div>
</div>

<div class="board" id="board">
  <div class="player" id="player">
    <img src="https://aiwe.cc/wp-content/uploads/2025/11/897cb201ac922a1f9ed6e6f9082e84f5.png">
  </div>

  <div class="center">
    <div class="msg" id="msg"></div>
    <div class="dice-box">
      <div class="dice face-1" id="dice1"><div class="dot"></div></div>
      <div class="dice face-1" id="dice2"><div class="dot"></div></div>
    </div>
    <button class="roll-btn" onclick="startGame()" id="rollBtn">æŠ•æ“²éª°å­</button>
  </div>
</div>

<!-- ğŸ§§ åº—å®¶å„ªæƒ å¡ç‰‡ -->
<div class="shop-popup" id="shopPopup">
  <img id="shopImg" src="">
  <div class="shop-content">
    <h2 id="shopName"></h2>
    <p id="shopDesc"></p>
    <div class="shop-buttons">
      <button class="claim" id="claimBtn">æ”¶è—å„ªæƒ </button>
      <button class="close" onclick="closeShop()">æ”¾æ£„æ”¶è—</button>
    </div>
  </div>
</div>

<!-- ğŸ« å„ªæƒ åˆ¸æ”¶é›†å€ -->
<div class="coupon-panel" id="couponPanel">
  <div class="coupon-panel-header">
    <h2>æˆ‘çš„å„ªæƒ åˆ¸ (<span id="couponCount">0</span>)</h2>
    <button class="close-btn" onclick="closeCouponPanel()">Ã—</button>
  </div>
  <div class="coupon-list" id="couponList">
    <div class="empty-state">
      <div class="icon">ğŸ«</div>
      <p>é‚„æ²’æœ‰æ”¶é›†ä»»ä½•å„ªæƒ åˆ¸<br>å¿«å»éŠæˆ²ä¸­æ”¶é›†å§ï¼</p>
    </div>
  </div>
</div>

<!-- ğŸ—ºï¸ åº—å®¶åœ°åœ– -->
<div class="map-panel" id="mapPanel">
  <div class="map-panel-header">
    <h2>åº—å®¶åœ°åœ–</h2>
    <button class="close-btn" onclick="closeMapPanel()">Ã—</button>
  </div>
  <div class="map-container">
    <div class="shop-list" id="shopList">
      <p style="text-align:center;color:#999;padding:20px;">è¼‰å…¥ä¸­...</p>
    </div>
  </div>
</div>

<!-- ğŸ“± åº•éƒ¨åŠŸèƒ½åˆ— -->
<div class="bottom-bar">
  <button onclick="openCouponPanel()">
    <span class="icon">ğŸ«</span>
    <span>å„ªæƒ åˆ¸</span>
  </button>
  <button id="lineLoginBtn" onclick="lineLogin()">
    <span class="icon">ğŸ“±</span>
    <span id="lineLoginText">LINEç™»å…¥</span>
  </button>
  <button onclick="openMapPanel()">
    <span class="icon">ğŸ—ºï¸</span>
    <span>åº—å®¶åœ°åœ–</span>
  </button>
  <!-- æ·»åŠ  SVG ç‰ˆæœ¬æŒ‰éˆ• -->
  <button onclick="switchToSVGVersion()">
    <span class="icon">ğŸ®</span>
    <span>SVGç‰ˆæœ¬</span>
  </button>
</div>

<!-- éŸ³æ•ˆ -->
<audio id="bgm" loop src="https://aiwe.cc/wp-content/uploads/2025/11/901cd11beb7b52aea3f9011f2d3d33bb.mp3"></audio>
<audio id="sDice" src="https://aiwe.cc/wp-content/uploads/2025/11/77b2287cce9574aeb82a8dbbcf200050.mp3"></audio>
<audio id="sMove" src="https://aiwe.cc/wp-content/uploads/2025/11/f8bf2fa137503315a28ad81a8aee77a5.mp3"></audio>

<script>
/* ============================================
 ğŸ® éŠæˆ²æ ¸å¿ƒè¨­å®š
============================================ */
const GAS_BASE = 'https://script.google.com/macros/s/AKfycbwXJn0qM-qt5VJyiV87i84ax6XTq3jEUC8buFpTWeniP83Pu5suQET-2RZzouUbLaiQ/exec';

const player = document.getElementById('player');
const board = document.getElementById('board');
const msg = document.getElementById('msg');
const dice1 = document.getElementById('dice1');
const dice2 = document.getElementById('dice2');
const rollBtn = document.getElementById('rollBtn');
const bgm = document.getElementById('bgm');
const sDice = document.getElementById('sDice');
const sMove = document.getElementById('sMove');
const shopPopup = document.getElementById('shopPopup');
const shopImg = document.getElementById('shopImg');
const shopName = document.getElementById('shopName');
const shopDesc = document.getElementById('shopDesc');
const claimBtn = document.getElementById('claimBtn');
const loginScreen = document.getElementById('loginScreen');

let currentShop = null;
const rows = 9, cols = 6;
let pos = 0;
let userId = localStorage.getItem('lineUserId') || "TEMP_USER";

/* === éŠæˆ²è·¯å¾‘ === */
const path = [];
for (let x = cols - 1; x >= 0; x--) path.push({ x, y: rows - 1 });
for (let y = rows - 2; y >= 0; y--) path.push({ x: 0, y });
for (let x = 1; x < cols; x++) path.push({ x, y: 0 });
for (let y = 1; y < rows - 1; y++) path.push({ x: cols - 1, y });

/* ============================================
 ğŸ² æŠ•æ“²èˆ‡ç§»å‹•
============================================ */
function startGame() {
  if (bgm.paused) { bgm.volume = 0.3; bgm.play().catch(()=>{}); }
  rollDice();
}

function updatePlayer() {
  const cell = path[pos];
  const w = board.clientWidth / cols;
  const h = board.clientHeight / rows;
  player.style.left = `${cell.x * w + w / 2 - player.clientWidth / 2}px`;
  player.style.top = `${cell.y * h + h / 2 - player.clientHeight / 2}px`;
}

function updateDiceFace(el, v) {
  el.className = 'dice face-' + v;
  el.innerHTML = '';
  for (let i = 0; i < v; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot';
    el.appendChild(dot);
  }
}

async function rollDice() {
  rollBtn.disabled = true;
  sDice.currentTime = 0; sDice.play();
  let count = 0, v1 = 1, v2 = 1;
  const interval = setInterval(() => {
    v1 = Math.floor(Math.random()*6)+1;
    v2 = Math.floor(Math.random()*6)+1;
    updateDiceFace(dice1,v1);
    updateDiceFace(dice2,v2);
    count++;
    if(count>15){
      clearInterval(interval);
      sDice.pause();
      movePlayer(v1+v2);
    }
  },80);
}

async function movePlayer(steps){
  player.classList.add('walking');
  sMove.loop = true; sMove.play().catch(()=>{});
  for(let i=0;i<steps;i++){
    pos = (pos+1)%path.length;
    updatePlayer();
    await new Promise(r=>setTimeout(r,450));
  }
  player.classList.remove('walking');
  sMove.pause();
  await checkEvent();
  rollBtn.disabled=false;
}

/* ============================================
 ğŸª åº—å®¶äº‹ä»¶
============================================ */
async function checkEvent(){
  try {
    const res = await fetch(`${GAS_BASE}?action=getShops`);
    const data = await res.json();
    if(data.status==="success" && data.shops.length>0){
      currentShop = data.shops[Math.floor(Math.random()*data.shops.length)];
      showShopPopup(currentShop);
    } else {
      msg.textContent="æš«ç„¡åº—å®¶è³‡æ–™";
    }
  } catch(e){
    console.error(e);
    msg.textContent="è¼‰å…¥åº—å®¶å¤±æ•—";
  }
}

function showShopPopup(shop){
  const imgUrl = shop["åœ–ç‰‡ç¶²å€"] || shop.icon || shop["åœ–ç¤º"] || "";
  shopImg.src = (imgUrl && imgUrl.startsWith("http")) ? imgUrl : "https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg";
  shopName.textContent = shop["åº—å®¶åç¨±"] || shop.name || "ç¥ç§˜åº—å®¶";
  shopDesc.textContent = shop["å„ªæƒ å…§å®¹"] || shop.couponDiscount || "é™æ™‚å„ªæƒ ä¸­ï¼";
  shopPopup.style.display='block';
}

/* ============================================
 ğŸ« æ”¶è—å„ªæƒ åˆ¸ (fetch ç‰ˆ)
============================================ */
claimBtn.addEventListener('click', async()=>{
  if(!currentShop) return;
  claimBtn.disabled=true;
  claimBtn.textContent="ğŸ‰ æ”¶è—ä¸­...";

  try{
    const payload = {
      action:'saveCoupon',
      userId:userId,
      shopId: currentShop.id || '',
      shopName: currentShop["åº—å®¶åç¨±"] || currentShop.name || 'æœªçŸ¥åº—å®¶',
      discount: currentShop["å„ªæƒ å…§å®¹"] || currentShop.couponDiscount || 'å„ªæƒ '
    };
    console.log("ğŸ“¤ ç™¼é€å„ªæƒ åˆ¸è³‡æ–™:",payload);

    const res = await fetch(GAS_BASE,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    const result = await res.json();
    console.log("ğŸ“¥ å›æ‡‰çµæœ:",result);

    if(result.status==='success'){
      claimBtn.textContent="âœ… æ”¶è—æˆåŠŸï¼";
      setTimeout(()=>{
        claimBtn.textContent="æ”¶è—å„ªæƒ ";
        claimBtn.disabled=false;
        closeShop();
        if(document.getElementById('couponPanel')?.classList.contains('show')){
          loadCoupons();
        }
      },1500);
    } else {
      throw new Error(result.message);
    }

  } catch(e){
    console.error('âŒ æ”¶è—éŒ¯èª¤:',e);
    claimBtn.textContent="âš ï¸ æ”¶è—å¤±æ•—";
    setTimeout(()=>{
      claimBtn.textContent="æ”¶è—å„ªæƒ ";
      claimBtn.disabled=false;
    },2000);
  }
});

/* ============================================
 ğŸ« å„ªæƒ åˆ¸æ¸…å–®
============================================ */
async function loadCoupons(){
  const list=document.getElementById('couponList');
  const count=document.getElementById('couponCount');
  list.innerHTML=`<p style="color:#999;text-align:center;">è¼‰å…¥ä¸­...</p>`;
  try{
    const res=await fetch(`${GAS_BASE}?action=getUserCoupons&userId=${encodeURIComponent(userId)}`);
    const result=await res.json();
    if(result.status==="success" && result.coupons.length>0){
      count.textContent=result.coupons.length;
      list.innerHTML=result.coupons.map(c=>`
        <div class="coupon-card">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg">
          <div class="coupon-card-info">
            <h3>${c.shopName}</h3>
            <p class="discount">${c.discount}</p>
            <p style="font-size:12px;color:#999;">${new Date(c.obtainedDate).toLocaleDateString('zh-TW')}</p>
          </div>
        </div>`).join('');
    } else {
      count.textContent='0';
      list.innerHTML='<div class="empty-state"><div class="icon">ğŸ«</div><p>å°šç„¡å„ªæƒ åˆ¸</p></div>';
    }
  } catch(e){
    console.error(e);
    list.innerHTML='<div class="empty-state"><div class="icon">âš ï¸</div><p>è¼‰å…¥å¤±æ•—</p></div>';
  }
}

/* ============================================
 ğŸ—ºï¸ åœ°åœ–è¼‰å…¥
============================================ */
async function loadShopMap(){
  const shopList=document.getElementById('shopList');
  shopList.innerHTML=`<p style="text-align:center;color:#999;">è¼‰å…¥ä¸­...</p>`;
  try{
    const res=await fetch(`${GAS_BASE}?action=getShops`);
    const result=await res.json();
    if(result.status==="success"){
      shopList.innerHTML=result.shops.map(s=>`
        <div class="shop-item">
          <img src="${s.icon||'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'}">
          <div class="shop-item-info">
            <h3>${s.name}</h3>
            <p>${s.couponDiscount}</p>
            <p class="address">ğŸ“${s.address}</p>
          </div>
        </div>`).join('');
    } else {
      shopList.innerHTML=`<p style="color:#999;">æ²’æœ‰åº—å®¶è³‡æ–™</p>`;
    }
  }catch(e){
    console.error(e);
    shopList.innerHTML=`<p style="color:#999;">è¼‰å…¥å¤±æ•—</p>`;
  }
}

/* ============================================
 â¯ï¸ åˆå§‹åŒ–
============================================ */
window.addEventListener('DOMContentLoaded',()=>{
  updatePlayer();
  console.log("âœ… éŠæˆ²è¼‰å…¥å®Œæˆ");
});
</script>

</body>
</html>
