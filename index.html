<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
<title>æ­¡æ¨‚å¤§å¯Œç¿</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>  
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Microsoft JhengHei",sans-serif;
  background:#111;
  height:100vh;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  padding-bottom:70px;
}

/* === LINE ç™»å…¥æ­¡è¿é é¢ === */
.login-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:999;padding:20px;
}
.login-screen.hidden{display:none;}
.login-box{
  background:white;border-radius:30px;
  padding:50px 40px;text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
  max-width:450px;width:100%;
  animation:slideIn 0.5s ease;
}
@keyframes slideIn{
  from{opacity:0;transform:translateY(-30px);}
  to{opacity:1;transform:translateY(0);}
}
.login-box .logo{
  font-size:80px;margin-bottom:20px;
  animation:bounce 1s infinite ease-in-out;
}
@keyframes bounce{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-10px);}
}
.login-box h1{
  font-size:36px;color:#333;margin-bottom:15px;
}
.login-box p{
  font-size:18px;color:#666;margin-bottom:40px;
  line-height:1.6;
}
.login-box .line-login-btn{
  width:100%;padding:20px;
  background:#06C755;color:white;
  border:none;border-radius:15px;
  font-size:24px;font-weight:bold;
  cursor:pointer;transition:all 0.3s ease;
  display:flex;align-items:center;justify-content:center;
  gap:15px;box-shadow:0 8px 20px rgba(6,199,85,0.3);
}
.login-box .line-login-btn:hover{
  background:#05b04b;transform:translateY(-2px);
  box-shadow:0 12px 30px rgba(6,199,85,0.4);
}
.login-box .line-login-btn .icon{
  font-size:32px;
}

.board{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translateY(-35px);
  width:95%;aspect-ratio:2/3;
  background:url("https://aiwe.cc/wp-content/uploads/2025/11/c4ca4238a0b923820dcc509a6f75849b-2.png") center/contain no-repeat;
  background-color:#000;border-radius:10px;overflow:hidden;
}
.player{
  position:absolute;
  width: 80px;    /* å¾ 150px æ”¹å° */
  height: 85px;   /* å¾ 160px æ”¹å° */
  transition:all .4s ease-in-out;
  z-index:10;
}
.player img{width:100%;height:100%;object-fit:contain;}
@keyframes walk{0%,100%{transform:rotate(0);}25%{transform:rotate(-4deg);}75%{transform:rotate(4deg);}}
.walking{animation:walk .45s infinite ease-in-out;}
.center{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  display:flex;flex-direction:column;align-items:center;gap:25px;
  z-index:5;
}
.msg{
  color:#000;
  font-size: 20px;  /* å¾ 28px æ”¹å° */
  font-weight:bold;
  text-shadow:1px 1px 2px rgba(255,255,255,.6);
  margin-bottom:5px;
  min-height:24px;
  transition:opacity .5s ease;
}
.dice-box{display:flex;gap:40px;}
.dice{
  width: 80px;    /* å¾ 160px æ”¹å° */
  height: 80px;   /* å¾ 160px æ”¹å° */
  background:white;
  border-radius:20px;  /* å¾ 30px æ”¹å° */
  box-shadow:0 5px 15px rgba(0,0,0,.3);  /* é™°å½±ä¹Ÿæ”¹å° */
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
}

.dot{
  width: 12px;    /* å¾ 22px æ”¹å° */
  height: 12px;   /* å¾ 22px æ”¹å° */
  background:black;
  border-radius:50%;
  position:absolute;
}

.dice-box{
  display:flex;
  gap: 20px;      /* å¾ 40px æ”¹å° */
}
.dot{width:22px;height:22px;background:black;border-radius:50%;position:absolute;}
.face-1 .dot:nth-child(1){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-2 .dot:nth-child(1){top:25%;left:25%;}
.face-2 .dot:nth-child(2){bottom:25%;right:25%;}
.face-3 .dot:nth-child(1){top:25%;left:25%;}
.face-3 .dot:nth-child(2){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-3 .dot:nth-child(3){bottom:25%;right:25%;}
.face-4 .dot:nth-child(1){top:25%;left:25%;}
.face-4 .dot:nth-child(2){top:25%;right:25%;}
.face-4 .dot:nth-child(3){bottom:25%;left:25%;}
.face-4 .dot:nth-child(4){bottom:25%;right:25%;}
.face-5 .dot:nth-child(1){top:25%;left:25%;}
.face-5 .dot:nth-child(2){top:25%;right:25%;}
.face-5 .dot:nth-child(3){top:50%;left:50%;transform:translate(-50%,-50%);}
.face-5 .dot:nth-child(4){bottom:25%;left:25%;}
.face-5 .dot:nth-child(5){bottom:25%;right:25%;}
.face-6 .dot:nth-child(1){top:25%;left:25%;}
.face-6 .dot:nth-child(2){top:25%;right:25%;}
.face-6 .dot:nth-child(3){top:50%;left:25%;transform:translateY(-50%);}
.face-6 .dot:nth-child(4){top:50%;right:25%;transform:translateY(-50%);}
.face-6 .dot:nth-child(5){bottom:25%;left:25%;}
.face-6 .dot:nth-child(6){bottom:25%;right:25%;}
.roll-btn{
  padding: 15px 30px;    /* å¾ 25px 60px æ”¹å° */
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:white;
  font-size: 20px;       /* å¾ 34px æ”¹å° */
  font-weight:bold;
  border:none;
  border-radius: 25px;   /* å¾ 40px æ”¹å° */
  box-shadow:0 4px 10px rgba(0,0,0,.3);  /* å¾ 8px 20px æ”¹å° */
  cursor:pointer;
}

/* === ä¸Šåœ–ä¸‹æ–‡ åç‰‡ç‰ˆå½ˆçª— === */
.shop-popup{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:85%;max-width:520px;
  background:white;color:#222;
  border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,.4);
  overflow-y:auto;text-align:center;
  max-height:90vh;
  z-index:50;display:none;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-45%);}to{opacity:1;transform:translate(-50%,-50%);}}
.shop-popup img{
  width:100%;height:auto;object-fit:cover;
  display:block;
  background:#eee;
}
.shop-content{
  padding:15px 20px 25px;
}
.shop-content h2{
  font-size:32px;color:#222;margin-bottom:8px;
}
.shop-content p{
  font-size:22px;color:#555;margin-bottom:20px;
}
.shop-buttons{
  display:flex;flex-direction:column;align-items:center;gap:12px;
}
.shop-buttons button{
  width:95%;
  border:none;border-radius:12px;
  padding:16px 20px;font-size:36px;font-weight:bold;cursor:pointer;
  color:white;transition:transform .2s ease;
}
.shop-buttons button:active{transform:scale(0.95);}
.shop-buttons .claim{background:#764ba2;}
.shop-buttons .close{background:#888;}

/* === åº•éƒ¨åŠŸèƒ½å€ï¼ˆåœ–ç¤ºæ”¾å¤§2å€ï¼‰=== */
.bottom-bar{
  position:fixed;bottom:0;left:0;right:0;
  height:70px;background:rgba(0,0,0,0.85);
  display:flex;justify-content:space-around;align-items:center;
  z-index:100;backdrop-filter:blur(10px);
  border-top:2px solid rgba(255,255,255,0.1);
}
.bottom-bar button{
  flex:1;height:100%;border:none;
  background:transparent;color:white;
  font-size:14px;font-weight:bold;
  cursor:pointer;transition:all .3s ease;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;
}
.bottom-bar button:active{background:rgba(255,255,255,0.1);}
.bottom-bar button .icon{font-size:56px;} /* å¾28pxæ”¾å¤§åˆ°56px (2å€) */
.bottom-bar button.logged-in{color:#4caf50;}

/* === å„ªæƒ åˆ¸æ”¶é›†å€å½ˆçª— === */
.coupon-panel{
  position:fixed;top:0;left:0;right:0;bottom:70px;
  background:white;z-index:200;display:none;
  overflow-y:auto;padding:20px;
}
.coupon-panel.show{display:block;}
.coupon-panel-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:20px;padding-bottom:15px;
  border-bottom:2px solid #eee;
}
.coupon-panel-header h2{font-size:28px;color:#333;}
.coupon-panel-header .close-btn{
  width:40px;height:40px;border:none;
  background:#ddd;border-radius:50%;
  font-size:24px;cursor:pointer;
}
.coupon-list{display:grid;gap:15px;}
.coupon-card{
  border:1px solid #ddd;border-radius:12px;
  padding:15px;display:flex;gap:15px;
  background:white;box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
.coupon-card img{
  width:80px;height:80px;object-fit:cover;
  border-radius:8px;flex-shrink:0;
}
.coupon-card-info{flex:1;}
.coupon-card-info h3{font-size:20px;margin-bottom:5px;color:#333;}
.coupon-card-info p{font-size:16px;color:#666;}
.coupon-card-info .discount{color:#e53935;font-weight:bold;}
.empty-state{
  text-align:center;padding:60px 20px;color:#999;
}
.empty-state .icon{font-size:64px;margin-bottom:20px;}
.empty-state p{font-size:18px;}

/* === åº—å®¶åœ°åœ–å½ˆçª— === */
.map-panel{
  position:fixed;top:0;left:0;right:0;bottom:70px;
  background:white;z-index:200;display:none;
  overflow-y:auto;
}
.map-panel.show{display:block;}
.map-panel-header{
  padding:15px 20px;background:#764ba2;color:white;
  display:flex;justify-content:space-between;align-items:center;
}
.map-panel-header h2{font-size:24px;}
.map-panel-header .close-btn{
  width:40px;height:40px;border:none;
  background:rgba(255,255,255,0.2);border-radius:50%;
  color:white;font-size:24px;cursor:pointer;
}
.map-container{
  padding:20px;
}
.shop-list{display:grid;gap:12px;}
.shop-item{
  border:1px solid #ddd;border-radius:10px;
  padding:12px;display:flex;gap:12px;
  background:white;
}
.shop-item img{
  width:60px;height:60px;object-fit:cover;
  border-radius:6px;flex-shrink:0;
}
.shop-item-info{flex:1;}
.shop-item-info h3{font-size:18px;margin-bottom:4px;}
.shop-item-info p{font-size:14px;color:#666;}
.shop-item-info .address{font-size:13px;color:#999;margin-top:4px;}

/* === è¼‰å…¥å‹•ç•« === */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- ğŸ” LINE ç™»å…¥æ­¡è¿é é¢ -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="logo">ğŸ²</div>
    <h1>æ­¡æ¨‚å¤§å¯Œç¿</h1>
    <p>æ­¡è¿ä¾†åˆ°æ¿æ©‹å•†åœˆï¼<br>è«‹å…ˆä½¿ç”¨ LINE ç™»å…¥é–‹å§‹éŠæˆ²ï¼Œ<br>æ”¶é›†å°ˆå±¬å„ªæƒ åˆ¸å§ï¼</p>
    <button class="line-login-btn" onclick="startLineLogin()">
      <span class="icon">ğŸ“±</span>
      <span>ä½¿ç”¨ LINE ç™»å…¥</span>
    </button>
  </div>
</div>

<div class="board" id="board">
  <div class="player" id="player">
    <img src="https://aiwe.cc/wp-content/uploads/2025/11/897cb201ac922a1f9ed6e6f9082e84f5.png">
  </div>

  <div class="center">
    <div class="msg" id="msg"></div>
    <div class="dice-box">
      <div class="dice face-1" id="dice1"><div class="dot"></div></div>
      <div class="dice face-1" id="dice2"><div class="dot"></div></div>
    </div>
    <button class="roll-btn" onclick="startGame()" id="rollBtn">æŠ•æ“²éª°å­</button>
  </div>
</div>

<!-- ğŸ§§ åº—å®¶å„ªæƒ å¡ç‰‡ -->
<div class="shop-popup" id="shopPopup">
  <img id="shopImg" src="">
  <div class="shop-content">
    <h2 id="shopName"></h2>
    <p id="shopDesc"></p>
    <div class="shop-buttons">
      <button class="claim" id="claimBtn">æ”¶è—å„ªæƒ </button>
      <button class="close" onclick="closeShop()">æ”¾æ£„æ”¶è—</button>
    </div>
  </div>
</div>

<!-- ğŸ« å„ªæƒ åˆ¸æ”¶é›†å€ -->
<div class="coupon-panel" id="couponPanel">
  <div class="coupon-panel-header">
    <h2>æˆ‘çš„å„ªæƒ åˆ¸ (<span id="couponCount">0</span>)</h2>
    <button class="close-btn" onclick="closeCouponPanel()">Ã—</button>
  </div>
  <div class="coupon-list" id="couponList">
    <div class="empty-state">
      <div class="icon">ğŸ«</div>
      <p>é‚„æ²’æœ‰æ”¶é›†ä»»ä½•å„ªæƒ åˆ¸<br>å¿«å»éŠæˆ²ä¸­æ”¶é›†å§ï¼</p>
    </div>
  </div>
</div>

<!-- ğŸ—ºï¸ åº—å®¶åœ°åœ– -->
<div class="map-panel" id="mapPanel">
  <div class="map-panel-header">
    <h2>åº—å®¶åœ°åœ–</h2>
    <button class="close-btn" onclick="closeMapPanel()">Ã—</button>
  </div>
  <div class="map-container">
    <div class="shop-list" id="shopList">
      <p style="text-align:center;color:#999;padding:20px;">è¼‰å…¥ä¸­...</p>
    </div>
  </div>
</div>

<!-- ğŸ“± åº•éƒ¨åŠŸèƒ½åˆ— -->
<div class="bottom-bar">
  <button onclick="openCouponPanel()">
    <span class="icon">ğŸ«</span>
    <span>å„ªæƒ åˆ¸</span>
  </button>
  <button id="lineLoginBtn" onclick="lineLogin()">
    <span class="icon">ğŸ“±</span>
    <span id="lineLoginText">LINEç™»å…¥</span>
  </button>
  <button onclick="openMapPanel()">
    <span class="icon">ğŸ—ºï¸</span>
    <span>åº—å®¶åœ°åœ–</span>
  </button>
  <!-- æ·»åŠ  SVG ç‰ˆæœ¬æŒ‰éˆ• -->
  <button onclick="switchToSVGVersion()">
    <span class="icon">ğŸ®</span>
    <span>SVGç‰ˆæœ¬</span>
  </button>
</div>

<!-- éŸ³æ•ˆ -->
<audio id="bgm" loop src="https://aiwe.cc/wp-content/uploads/2025/11/901cd11beb7b52aea3f9011f2d3d33bb.mp3"></audio>
<audio id="sDice" src="https://aiwe.cc/wp-content/uploads/2025/11/77b2287cce9574aeb82a8dbbcf200050.mp3"></audio>
<audio id="sMove" src="https://aiwe.cc/wp-content/uploads/2025/11/f8bf2fa137503315a28ad81a8aee77a5.mp3"></audio>

<script>
// ğŸ® éŠæˆ²æ ¸å¿ƒè®Šæ•¸èˆ‡è¨­å®š
// ============================================
const GAS_BASE = 'https://script.google.com/macros/s/AKfycbygVhby4AkYgsvvLhY2sm-bpMHEGNpJRZwZZ826oyxY-8-tXRkJOOQjwYRmRIEG5nGX/exec';

// âœ… ç°¡åŒ– GAS URL - ä½¿ç”¨é è¨­çš„åƒæ•¸è¨­å®š
const GAS_SHOP_URL = `${GAS_BASE}?action=getShops`;
const GAS_COUPON_BASE = `${GAS_BASE}?action=getCoupons`;

const player = document.getElementById('player');
const board = document.getElementById('board');
const msg = document.getElementById('msg');
const dice1 = document.getElementById('dice1');
const dice2 = document.getElementById('dice2');
const rollBtn = document.getElementById('rollBtn');
const bgm = document.getElementById('bgm');
const sDice = document.getElementById('sDice');
const sMove = document.getElementById('sMove');
const shopPopup = document.getElementById('shopPopup');
const shopImg = document.getElementById('shopImg');
const shopName = document.getElementById('shopName');
const shopDesc = document.getElementById('shopDesc');
const claimBtn = document.getElementById('claimBtn');
const loginScreen = document.getElementById('loginScreen');

let currentShop = null;
const rows = 9, cols = 6;
let pos = 0;
let userId = "TEMP_USER";

// éŠæˆ²è·¯å¾‘è¨­å®š
const path = [];
for (let x = cols - 1; x >= 0; x--) path.push({ x, y: rows - 1 });
for (let y = rows - 2; y >= 0; y--) path.push({ x: 0, y });
for (let x = 1; x < cols; x++) path.push({ x, y: 0 });
for (let y = 1; y < rows - 1; y++) path.push({ x: cols - 1, y });

// ============================================
// ğŸ® éŠæˆ²æ ¸å¿ƒåŠŸèƒ½
// ============================================
function startGame() {
  if (bgm.paused) {
    bgm.volume = 0.3;
    bgm.play().catch(() => {});
  }
  rollDice();
}

function showMsg(t) {
  msg.textContent = t;
  msg.style.opacity = 1;
}

function hideMsg() {
  msg.style.opacity = 0;
  setTimeout(() => msg.textContent = "", 500);
}

function updatePlayer() {
  const cell = path[pos];
  const w = board.clientWidth / cols;
  const h = board.clientHeight / rows;
  let offsetX = 0;
  
  if (cell.y === rows - 1) offsetX = -w * 0.05;
  else if (cell.y === 0) offsetX = w * 0.05;
  
  if (cell.x === cols - 1 && cell.y > 0 && cell.y < rows - 1) offsetX -= w * 0.27;
  
  player.style.left = `${cell.x * w + w / 2 - player.clientWidth / 2 + offsetX}px`;
  player.style.top = `${cell.y * h + h / 2 - player.clientHeight / 2}px`;
}

function updateDiceFace(el, v) {
  el.className = 'dice face-' + v;
  el.innerHTML = '';
  for (let i = 0; i < v; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot';
    el.appendChild(dot);
  }
}

async function rollDice() {
  rollBtn.disabled = true;
  sDice.currentTime = 0;
  sDice.play();
  
  let count = 0, v1 = 1, v2 = 1;
  const interval = setInterval(() => {
    v1 = Math.floor(Math.random() * 6) + 1;
    v2 = Math.floor(Math.random() * 6) + 1;
    updateDiceFace(dice1, v1);
    updateDiceFace(dice2, v2);
    count++;
    
    if (count > 15) {
      clearInterval(interval);
      sDice.pause();
      const total = v1 + v2;
      showMsg(`å‰é€² ${total} æ­¥ï¼`);
      movePlayer(total);
    }
  }, 80);
}

async function movePlayer(steps) {
  player.classList.add('walking');
  sMove.loop = true;
  sMove.currentTime = 0;
  sMove.play().catch(() => {});
  
  for (let i = 0; i < steps; i++) {
    pos = (pos + 1) % path.length;
    updatePlayer();
    await new Promise(r => setTimeout(r, 450));
  }
  
  player.classList.remove('walking');
  sMove.pause();
  sMove.currentTime = 0;
  
  await checkEvent();
  setTimeout(() => hideMsg(), 800);
  rollBtn.disabled = false;
}

// ============================================
// ğŸª åº—å®¶èˆ‡å„ªæƒ åŠŸèƒ½ - ä¿®æ­£è¼‰å…¥é‚è¼¯
// ============================================
async function checkEvent() {
  const cell = path[pos];
  
  // æ‡²ç½°æ ¼é‚è¼¯
  if (cell.x === 0 && cell.y === 0) {
    showMsg("è¸©åˆ°æ‡²ç½°æ ¼ï¼é€€å›7æ­¥ï¼");
    for (let i = 0; i < 7; i++) {
      pos = (pos - 1 + path.length) % path.length;
      updatePlayer();
      await new Promise(r => setTimeout(r, 300));
    }
    return;
  }
  
  // âœ… ä¿®æ­£ï¼šè¼‰å…¥åº—å®¶è³‡æ–™
  try {
    const shops = await loadShops();
    console.log('ğŸ›ï¸ è¼‰å…¥åˆ°çš„åº—å®¶è³‡æ–™:', shops);
    
    if (shops && shops.length > 0) {
      const shop = shops[Math.floor(Math.random() * shops.length)];
      currentShop = shop;
      showShopPopup(shop);
    } else {
      console.log('âŒ æ²’æœ‰å¯ç”¨çš„åº—å®¶è³‡æ–™');
      showMsg('æš«ç„¡åº—å®¶è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  } catch (error) {
    console.error('âŒ è¼‰å…¥åº—å®¶æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
    showMsg('è¼‰å…¥åº—å®¶å¤±æ•—');
  }
}

function showShopPopup(shop) {
  console.log('ğŸª é¡¯ç¤ºåº—å®¶å½ˆçª—:', shop);
  
  // ä¿®æ­£æ¬„ä½å°æ‡‰ - æ ¹æ“š GAS å›å‚³çš„å¯¦éš›æ¬„ä½åç¨±
  const imgUrl = shop["åœ–ç‰‡ç¶²å€"] || shop.icon || shop["åœ–ç¤º"] || shop.imageUrl || "";
  const shopNameText = shop["åº—å®¶åç¨±"] || shop.name || shop.shopName || "ç¥ç§˜åº—å®¶";
  const shopDescText = shop["å„ªæƒ å…§å®¹"] || shop.discount || shop.description || "é™æ™‚å„ªæƒ ï¼Œè¶•å¿«ä¾†çœ‹çœ‹ï¼";
  
  // å®‰å…¨è¨­ç½®åœ–ç‰‡
  if (imgUrl && (imgUrl.startsWith("http://") || imgUrl.startsWith("https://"))) {
    shopImg.src = imgUrl;
    shopImg.onerror = function() {
      this.src = "https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg";
    };
  } else {
    shopImg.src = "https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg";
  }
  
  shopName.textContent = shopNameText;
  shopDesc.textContent = shopDescText;
  shopPopup.style.display = 'block';
  claimBtn.disabled = false;
  claimBtn.textContent = "æ”¶è—å„ªæƒ ";
}

function closeShop() {
  shopPopup.style.display = 'none';
}

// âœ… ä¿®æ­£ï¼šè¼‰å…¥åº—å®¶è³‡æ–™å‡½æ•¸
async function loadShops() {
  try {
    console.log('ğŸ“‹ é–‹å§‹è¼‰å…¥åº—å®¶è³‡æ–™...');
    
    const response = await fetch(`${GAS_BASE}?action=getShops`);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const result = await response.json();
    console.log('ğŸ›ï¸ åº—å®¶è³‡æ–™APIå›æ‡‰:', result);
    
    // ä¿®æ­£ï¼šæ›´åš´è¬¹çš„éŒ¯èª¤è™•ç†
    if (result && result.success === true && Array.isArray(result.data)) {
      console.log(`âœ… æˆåŠŸè¼‰å…¥ ${result.data.length} å€‹åº—å®¶`);
      return result.data;
    } else {
      // å¦‚æœæ²’æœ‰æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯ï¼Œæä¾›é»˜èªè¨Šæ¯
      const errorMsg = result.message || 'è¼‰å…¥åº—å®¶è³‡æ–™å¤±æ•—';
      console.error('âŒ è¼‰å…¥åº—å®¶è³‡æ–™å¤±æ•—:', errorMsg);
      return getDefaultShops();
    }
  } catch (error) {
    console.error('âŒ è¼‰å…¥åº—å®¶è³‡æ–™ç™¼ç”ŸéŒ¯èª¤:', error);
    return getDefaultShops();
  }
}

// âœ… å‚™ç”¨åº—å®¶è³‡æ–™
function getDefaultShops() {
  return [
    {
      "åº—å®¶åç¨±": "æ¿æ©‹å’–å•¡å»³",
      "å„ªæƒ å…§å®¹": "æ‹¿éµç¬¬äºŒæ¯åŠåƒ¹",
      "åœ–ç‰‡ç¶²å€": "https://example.com/coffee.jpg",
      "åœ°å€": "æ¿æ©‹å€ä¸­å±±è·¯ä¸€æ®µ123è™Ÿ"
    },
    {
      "åº—å®¶åç¨±": "å•†åœˆæœé£¾åº—", 
      "å„ªæƒ å…§å®¹": "å…¨é¤¨8æŠ˜å„ªæƒ ",
      "åœ–ç‰‡ç¶²å€": "https://example.com/clothing.jpg",
      "åœ°å€": "æ¿æ©‹å€æ–‡åŒ–è·¯äºŒæ®µ456è™Ÿ"
    }
  ];
}

// ============================================
// ğŸ« å„ªæƒ åˆ¸æ”¶é›†å€åŠŸèƒ½ - ä¿®æ­£è¼‰å…¥é‚è¼¯
// ============================================
function openCouponPanel() {
  document.getElementById('couponPanel').classList.add('show');
  loadCoupons();
}

function closeCouponPanel() {
  document.getElementById('couponPanel').classList.remove('show');
}

async function loadCoupons() {
  const couponList = document.getElementById('couponList');
  const couponCount = document.getElementById('couponCount');
  
  try {
    console.log('ğŸ« é–‹å§‹è¼‰å…¥å„ªæƒ åˆ¸...');
    
    // ä½¿ç”¨ GET è«‹æ±‚è¼‰å…¥å„ªæƒ åˆ¸
    const couponUrl = `${GAS_BASE}?action=getUserCoupons&userId=${encodeURIComponent(userId)}`;
    const response = await fetch(couponUrl);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const result = await response.json();
    console.log('ğŸ« å„ªæƒ åˆ¸APIå›æ‡‰:', result);
    
    // ä¿®æ­£ï¼šæ›´åš´è¬¹çš„æ¢ä»¶åˆ¤æ–·
    if (result && result.status === 'success' && Array.isArray(result.coupons)) {
      const coupons = result.coupons;
      couponCount.textContent = coupons.length;
      
      if (coupons.length > 0) {
        couponList.innerHTML = coupons.map(coupon => `
          <div class="coupon-card">
            <img src="${coupon.imageUrl || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'}" 
                 onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'">
            <div class="coupon-card-info">
              <h3>${coupon.shopName || 'åº—å®¶åç¨±'}</h3>
              <p class="discount">${coupon.discount || 'å„ªæƒ å…§å®¹'}</p>
              <p style="font-size:14px;color:#999;margin-top:4px;">
                ${coupon.obtainedDate ? new Date(coupon.obtainedDate).toLocaleDateString('zh-TW') : 'ä»Šå¤©'}
              </p>
              <p style="font-size:12px;color:#${coupon.used ? 'e53935' : '4caf50'};">
                ${coupon.used ? 'å·²ä½¿ç”¨' : 'å¯ä½¿ç”¨'}
              </p>
            </div>
          </div>
        `).join('');
      } else {
        couponList.innerHTML = `
          <div class="empty-state">
            <div class="icon">ğŸ«</div>
            <p>é‚„æ²’æœ‰æ”¶é›†ä»»ä½•å„ªæƒ åˆ¸<br>å¿«å»éŠæˆ²ä¸­æ”¶é›†å§ï¼</p>
          </div>
        `;
      }
    } else {
      couponCount.textContent = '0';
      const errorMsg = result && result.message ? result.message : 'è¼‰å…¥å„ªæƒ åˆ¸å¤±æ•—';
      console.error('âŒ å„ªæƒ åˆ¸è¼‰å…¥å¤±æ•—:', errorMsg);
      couponList.innerHTML = `
        <div class="empty-state">
          <div class="icon">ğŸ«</div>
          <p>é‚„æ²’æœ‰æ”¶é›†ä»»ä½•å„ªæƒ åˆ¸<br>å¿«å»éŠæˆ²ä¸­æ”¶é›†å§ï¼</p>
        </div>
      `;
    }
  } catch (error) {
    console.error('âŒ è¼‰å…¥å„ªæƒ åˆ¸å¤±æ•—:', error);
    couponList.innerHTML = `
      <div class="empty-state">
        <div class="icon">âš ï¸</div>
        <p>è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>
      </div>
    `;
  }
}
// é™¤éŒ¯å‡½æ•¸ï¼šæª¢æŸ¥ GAS å›æ‡‰çµæ§‹
async function debugGASResponse() {
  try {
    console.log('ğŸ” é–‹å§‹é™¤éŒ¯ GAS å›æ‡‰çµæ§‹...');
    
    // æ¸¬è©¦åº—å®¶ API
    const shopResponse = await fetch(`${GAS_BASE}?action=getShops`);
    const shopResult = await shopResponse.json();
    console.log('ğŸª åº—å®¶ API å›æ‡‰çµæ§‹:', shopResult);
    
    // æ¸¬è©¦å„ªæƒ åˆ¸ API
    const couponResponse = await fetch(`${GAS_BASE}?action=getUserCoupons&userId=test`);
    const couponResult = await couponResponse.json();
    console.log('ğŸ« å„ªæƒ åˆ¸ API å›æ‡‰çµæ§‹:', couponResult);
    
    // æ¸¬è©¦ POST è«‹æ±‚
    const formData = new FormData();
    formData.append('action', 'saveCoupon');
    formData.append('userId', 'test_user');
    formData.append('shopName', 'æ¸¬è©¦åº—å®¶');
    formData.append('discount', 'æ¸¬è©¦å„ªæƒ ');
    
    const postResponse = await fetch(GAS_BASE, {
      method: 'POST',
      body: formData
    });
    const postResult = await postResponse.json();
    console.log('ğŸ“¨ POST è«‹æ±‚å›æ‡‰çµæ§‹:', postResult);
    
  } catch (error) {
    console.error('âŒ é™¤éŒ¯å¤±æ•—:', error);
  }
}

// åœ¨é é¢è¼‰å…¥æ™‚åŸ·è¡Œé™¤éŒ¯ï¼ˆå¯é¸ï¼‰
// window.addEventListener('DOMContentLoaded', function() {
//   setTimeout(debugGASResponse, 1000);
// });
// ============================================
// ğŸ“± LINE ç™»å…¥åŠŸèƒ½ - ä½¿ç”¨ LIFF å…§å»ºç™»å…¥
// ============================================
let liffInitialized = false;

// åˆå§‹åŒ– LIFF
async function initLiff() {
    try {
        if (typeof liff === 'undefined') {
            console.log('âŒ LIFF SDK æœªè¼‰å…¥');
            return false;
        }
        
        await liff.init({ 
            liffId: '2008231249-7DlMkygo' // æ‚¨çš„ LIFF ID
        });
        liffInitialized = true;
        console.log('âœ… LIFF åˆå§‹åŒ–æˆåŠŸ');
        return true;
    } catch (error) {
        console.error('âŒ LIFF åˆå§‹åŒ–å¤±æ•—:', error);
        return false;
    }
}

async function startLineLogin() {
  try {
    console.log('=== ğŸ” é–‹å§‹ LINE ç™»å…¥æµç¨‹ ===');
    
    // ç¢ºä¿ LIFF å·²åˆå§‹åŒ–
    if (!liffInitialized) {
      const initialized = await initLiff();
      if (!initialized) {
        alert('LINE ç™»å…¥åŠŸèƒ½åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
        return;
      }
    }
    
    // ä½¿ç”¨ LIFF å…§å»ºçš„ç™»å…¥åŠŸèƒ½
    if (!liff.isLoggedIn()) {
      console.log('ğŸ” åŸ·è¡Œ LIFF ç™»å…¥...');
      liff.login();
    } else {
      console.log('âœ… ç”¨æˆ¶å·²ç™»å…¥ï¼Œå–å¾—ç”¨æˆ¶è³‡æ–™');
      await getLineProfile();
    }
  } catch (error) {
    console.error('âŒ LINE ç™»å…¥ç™¼ç”ŸéŒ¯èª¤:', error);
    alert('LINE ç™»å…¥ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
  }
}

// ä½¿ç”¨ LIFF å–å¾—ç”¨æˆ¶è³‡æ–™
async function getLineProfile() {
  try {
    console.log('ğŸ“± å–å¾— LINE ç”¨æˆ¶è³‡æ–™...');
    const profile = await liff.getProfile();
    
    // å„²å­˜ç”¨æˆ¶è³‡æ–™
    localStorage.setItem('lineUserId', profile.userId);
    localStorage.setItem('lineDisplayName', profile.displayName);
    localStorage.setItem('linePictureUrl', profile.pictureUrl || '');
    
    // æ›´æ–° UI
    updateUserInterface({
      userId: profile.userId,
      displayName: profile.displayName,
      pictureUrl: profile.pictureUrl
    });
    
    console.log('âœ… LINE ç”¨æˆ¶è³‡æ–™å–å¾—æˆåŠŸ:', profile.displayName);
    
  } catch (error) {
    console.error('âŒ å–å¾— LINE ç”¨æˆ¶è³‡æ–™å¤±æ•—:', error);
    alert('å–å¾—ç”¨æˆ¶è³‡æ–™å¤±æ•—ï¼Œè«‹é‡è©¦');
  }
}

// æª¢æŸ¥ç™»å…¥ç‹€æ…‹
// æª¢æŸ¥ç™»å…¥ç‹€æ…‹
async function checkLoginStatus() {
  try {
    // å¦‚æœä½¿ç”¨ LIFFï¼Œæª¢æŸ¥ LIFF ç™»å…¥ç‹€æ…‹
    if (typeof liff !== 'undefined' && liff.isInClient()) {
      if (liff.isLoggedIn()) {
        await getLineProfile();
      }
    } else {
      // æª¢æŸ¥ localStorage ä¸­çš„ç™»å…¥ç‹€æ…‹
      const params = new URLSearchParams({
        action: 'checkLoginStatus',
        userId: localStorage.getItem('lineUserId') || 'temp'
      });
      
      const response = await safeFetch(`${GAS_BASE}?${params}`);
      
      if (response.success && response.loggedIn) {
        updateUserInterface(response.userInfo);
      }
    }
  } catch (error) {
    console.error('æª¢æŸ¥ç™»å…¥ç‹€æ…‹å¤±æ•—:', error);
  }
}

// æ›´æ–°ç”¨æˆ¶ç•Œé¢
function updateUserInterface(userInfo) {
  if (userInfo && userInfo.userId) {
    localStorage.setItem('lineUserId', userInfo.userId);
    localStorage.setItem('lineDisplayName', userInfo.displayName);
    localStorage.setItem('linePictureUrl', userInfo.pictureUrl || '');
    
    document.getElementById('lineLoginText').textContent = userInfo.displayName;
    document.getElementById('lineLoginBtn').classList.add('logged-in');
    userId = userInfo.userId;
    
    // éš±è—ç™»å…¥ç•«é¢
    loginScreen.classList.add('hidden');
    
    alert(`æ­¡è¿ï¼Œ${userInfo.displayName}ï¼\n\næ‚¨çš„å„ªæƒ åˆ¸å·²ç¶å®šåˆ° LINE å¸³è™Ÿã€‚`);
  }
}

// åº•éƒ¨åŠŸèƒ½åˆ—çš„ LINE ç™»å…¥/ç™»å‡ºæŒ‰éˆ•
async function lineLogin() {
  const lineLoginBtn = document.getElementById('lineLoginBtn');
  const lineLoginText = document.getElementById('lineLoginText');
  
  if (localStorage.getItem('lineUserId')) {
    // å·²ç™»å…¥ï¼Œé¡¯ç¤ºç™»å‡ºé¸é …
    if (confirm('ç¢ºå®šè¦ç™»å‡º LINE å¸³è™Ÿå—ï¼Ÿ')) {
      localStorage.removeItem('lineUserId');
      localStorage.removeItem('lineDisplayName');
      localStorage.removeItem('linePictureUrl');
      
      lineLoginText.textContent = 'LINEç™»å…¥';
      lineLoginBtn.classList.remove('logged-in');
      userId = 'TEMP_USER';
      
      alert('å·²ç™»å‡ºï¼');
      
      // é¡¯ç¤ºç™»å…¥ç•«é¢
      loginScreen.classList.remove('hidden');
      
      if (document.getElementById('couponPanel').classList.contains('show')) {
        loadCoupons();
      }
    }
  } else {
    // æœªç™»å…¥ï¼ŒåŸ·è¡Œç™»å…¥
    startLineLogin();
  }
}

// ============================================
// ğŸ—ºï¸ åº—å®¶åœ°åœ–åŠŸèƒ½ - ä¿®æ­£è¼‰å…¥é‚è¼¯
// ============================================
function openMapPanel() {
  document.getElementById('mapPanel').classList.add('show');
  loadShopMap();
}

function closeMapPanel() {
  document.getElementById('mapPanel').classList.remove('show');
}

async function loadShopMap() {
  const shopList = document.getElementById('shopList');
  
  try {
    console.log('ğŸ—ºï¸ é–‹å§‹è¼‰å…¥åº—å®¶åœ°åœ–...');
    const shops = await loadShops();
    
    if (shops && shops.length > 0) {
      shopList.innerHTML = shops.map(shop => `
        <div class="shop-item">
          <img src="${shop['åœ–ç‰‡ç¶²å€'] || shop.icon || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'}"
               onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'">
          <div class="shop-item-info">
            <h3>${shop['åº—å®¶åç¨±'] || 'åº—å®¶åç¨±'}</h3>
            <p>${shop['å„ªæƒ å…§å®¹'] || 'å„ªæƒ å…§å®¹'}</p>
            <p class="address">ğŸ“ ${shop['åœ°å€'] || 'åœ°å€æœªæä¾›'}</p>
          </div>
        </div>
      `).join('');
    } else {
      shopList.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">æ²’æœ‰åº—å®¶è³‡æ–™</p>';
    }
  } catch (error) {
    console.error('âŒ è¼‰å…¥åº—å®¶åœ°åœ–å¤±æ•—:', error);
    shopList.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
  }
}

// ============================================
// ğŸ”§ å·¥å…·å‡½æ•¸ - åŠ å¼·éŒ¯èª¤è™•ç†
// ============================================
// å®‰å…¨è«‹æ±‚å‡½æ•¸
async function safeFetch(url, options = {}) {
  try {
    console.log(`ğŸŒ ç™¼é€è«‹æ±‚: ${url}`);
    const response = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const result = await response.json();
    console.log(`âœ… è«‹æ±‚æˆåŠŸ:`, result);
    return result;
  } catch (error) {
    console.error('âŒ è«‹æ±‚å¤±æ•—:', error);
    return { success: false, message: error.message };
  }
}

// åœ¨æ”¶è—æŒ‰éˆ•äº‹ä»¶ä¸­ï¼Œä¿®æ­£åº—å®¶è³‡æ–™çš„å–å¾—
claimBtn.addEventListener('click', async () => {
  if (!currentShop) return;
  
  claimBtn.disabled = true;
  claimBtn.textContent = "ğŸ‰ æ”¶è—ä¸­...";
  
  try {
    console.log('ğŸ›ï¸ ç•¶å‰åº—å®¶è³‡æ–™:', currentShop);
    
    // ä¿®æ­£æ¬„ä½å°æ‡‰ - æ ¹æ“š GAS å›å‚³çš„å¯¦éš›çµæ§‹
    const shopName = currentShop["åº—å®¶åç¨±"] || currentShop.name || currentShop.shopName || '';
    const discount = currentShop["å„ªæƒ å…§å®¹"] || currentShop.discount || currentShop.description || '';
    const imageUrl = currentShop["åœ–ç‰‡ç¶²å€"] || currentShop.icon || currentShop.imageUrl || '';
    const shopId = currentShop.id || currentShop["åº—å®¶ID"] || 'shop_' + Date.now();
    
    console.log('ğŸ“¦ æº–å‚™æ”¶è—çš„è³‡æ–™:', { shopName, discount, shopId, userId });
    
    // ä½¿ç”¨ FormData
    const formData = new FormData();
    formData.append('action', 'saveCoupon');
    formData.append('userId', userId);
    formData.append('shopId', shopId);
    formData.append('shopName', shopName);
    formData.append('discount', discount);
    formData.append('imageUrl', imageUrl);
    
    const response = await fetch(GAS_BASE, {
      method: 'POST',
      body: formData
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const result = await response.json();
    console.log('ğŸ’¾ æ”¶è—å„ªæƒ åˆ¸å›æ‡‰:', result);
    
    if (result.status === 'success') {
      claimBtn.textContent = "âœ… æ”¶è—æˆåŠŸï¼";
      setTimeout(() => {
        closeShop();
        if (document.getElementById('couponPanel').classList.contains('show')) {
          loadCoupons();
        }
      }, 1500);
    } else {
      claimBtn.textContent = "âš ï¸ æ”¶è—å¤±æ•—";
      console.error('æ”¶è—å¤±æ•—:', result.message);
      setTimeout(() => {
        claimBtn.textContent = "æ”¶è—å„ªæƒ ";
        claimBtn.disabled = false;
      }, 2000);
    }
    
  } catch (error) {
    console.error('âŒ æ”¶è—éŒ¯èª¤:', error);
    claimBtn.textContent = "âš ï¸ ç¶²è·¯éŒ¯èª¤";
    setTimeout(() => {
      claimBtn.textContent = "æ”¶è—å„ªæƒ ";
      claimBtn.disabled = false;
    }, 2000);
  }
});
// ============================================
// ğŸ“± åº•éƒ¨åŠŸèƒ½åˆ— - æ·»åŠ  SVG ç‰ˆæœ¬åˆ‡æ›
// ============================================
function switchToSVGVersion() {
  if (confirm('è¦åˆ‡æ›åˆ° SVG ç‰ˆæœ¬éŠæˆ²å—ï¼Ÿ')) {
    window.location.href = 'game.html';
  }
}

// ============================================
// ğŸ” é é¢è¼‰å…¥æ™‚æª¢æŸ¥ LINE ç™»å…¥ç‹€æ…‹
// ============================================
window.addEventListener('DOMContentLoaded', async function() {
  console.log('=== ğŸ“± åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼ ===');
  
  // å˜—è©¦åˆå§‹åŒ– LIFFï¼ˆéå¼·åˆ¶ï¼‰
  try {
    await initLiff();
    
    // å¦‚æœ LIFF åˆå§‹åŒ–æˆåŠŸä¸”ç”¨æˆ¶å·²ç™»å…¥ï¼Œè‡ªå‹•å–å¾—è³‡æ–™
    if (liffInitialized && liff.isLoggedIn()) {
      console.log('âœ… LIFF ç”¨æˆ¶å·²ç™»å…¥ï¼Œè‡ªå‹•å–å¾—è³‡æ–™');
      await getLineProfile();
      
      // å¦‚æœæˆåŠŸå–å¾— LINE è³‡æ–™ï¼Œå°±éš±è—ç™»å…¥ç•«é¢
      if (localStorage.getItem('lineUserId')) {
        loginScreen.classList.add('hidden');
        return;
      }
    }
  } catch (error) {
    console.log('â„¹ï¸ LIFF åˆå§‹åŒ–å¤±æ•—æˆ–æœªä½¿ç”¨ LIFFï¼Œç¹¼çºŒå…¶ä»–ç™»å…¥æ–¹å¼');
  }
  
  // åŸæœ‰çš„æª¢æŸ¥é‚è¼¯
  console.log('=== ğŸ“± æª¢æŸ¥é é¢åƒæ•¸ ===');
  const urlParams = new URLSearchParams(window.location.search);
  const lineUserId = urlParams.get('lineUserId');
  const lineDisplayName = urlParams.get('lineDisplayName');
  
  if (lineUserId && lineDisplayName) {
    console.log('ğŸ‰ åµæ¸¬åˆ° LINE ç™»å…¥æˆåŠŸï¼');
    console.log('   User ID:', lineUserId);
    console.log('   é¡¯ç¤ºåç¨±:', decodeURIComponent(lineDisplayName));
    
    // å„²å­˜åˆ° localStorage
    localStorage.setItem('lineUserId', lineUserId);
    localStorage.setItem('lineDisplayName', decodeURIComponent(lineDisplayName));
    localStorage.setItem('linePictureUrl', decodeURIComponent(linePictureUrl || ''));
    
    // æ›´æ–° UI
    document.getElementById('lineLoginText').textContent = decodeURIComponent(lineDisplayName);
    document.getElementById('lineLoginBtn').classList.add('logged-in');
    userId = lineUserId;
    
    // éš±è—ç™»å…¥ç•«é¢ï¼Œé€²å…¥éŠæˆ²
    loginScreen.classList.add('hidden');
    
    console.log('âœ… LINE ç™»å…¥è³‡æ–™å·²å„²å­˜');
    
    // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
    setTimeout(() => {
      alert(`æ­¡è¿ï¼Œ${decodeURIComponent(lineDisplayName)}ï¼\n\næ‚¨çš„å„ªæƒ åˆ¸å·²ç¶å®šåˆ° LINE å¸³è™Ÿã€‚`);
    }, 500);
    
    // æ¸…é™¤ URL åƒæ•¸
    window.history.replaceState({}, document.title, window.location.pathname);
  } else {
    // æª¢æŸ¥ localStorage æ˜¯å¦æœ‰ç™»å…¥è³‡æ–™
    const storedUserId = localStorage.getItem('lineUserId');
    const storedDisplayName = localStorage.getItem('lineDisplayName');
    
    if (storedUserId) {
      console.log('âœ… ç”¨æˆ¶å·²ç™»å…¥ï¼ˆå¾ localStorageï¼‰');
      console.log('   User ID:', storedUserId);
      console.log('   é¡¯ç¤ºåç¨±:', storedDisplayName);
      
      document.getElementById('lineLoginText').textContent = storedDisplayName || 'å·²ç™»å…¥';
      document.getElementById('lineLoginBtn').classList.add('logged-in');
      userId = storedUserId;
      
      // éš±è—ç™»å…¥ç•«é¢ï¼Œé€²å…¥éŠæˆ²
      loginScreen.classList.add('hidden');
    } else {
      console.log('âšª ç”¨æˆ¶æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥ç•«é¢');
      // é¡¯ç¤ºç™»å…¥ç•«é¢
      loginScreen.classList.remove('hidden');
    }
  }
  
  // åˆå§‹åŒ–è§’è‰²ä½ç½®
  updatePlayer();
});
</script>
</body>
</html>
